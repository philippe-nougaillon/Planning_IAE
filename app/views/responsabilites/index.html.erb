<div class="flex items-center justify-between border-b mt-6 mb-2 pb-4">
  <h1 class="text-3xl"><%= fa_icon 'user-md' %> Liste des responsabilités </h1>
</div>

<div class="bs-container mx-auto sm:px-4 max-w-full p-4 shadow mb-4">
  <%= form_tag request.path, method: :get do %>
    <div class="flex flex-wrap">

      <div class="sm:w-1/6 pr-2">
        <%= label_tag :start_date, "Période du" %>
        <%= text_field_tag :start_date, params[:start_date], type:'date', class:"input input-bordered input-sm w-full" %>
      </div>

      <div class="sm:w-1/6 pr-2">
        <%= label_tag :end_date, "au" %>
        <%= text_field_tag :end_date, params[:end_date], type:'date', class:"input input-bordered input-sm w-full", onchange: 'this.form.submit()' %>
      </div>

      <div class="sm:w-4/12 pr-2">
        <%= label_tag :status, "Statut" %>
        <div class="join w-full">
          <%= select_tag :status, options_for_select(Intervenant.statuses, 
                params[:status]), include_blank:true,
                class: 'select select-bordered select-sm w-full', onchange: 'this.form.submit()' %>
        </div>
      </div>

      <div class="sm:w-4/12">
        <%= label_tag :activité, "Activité" %>
        <%= select_tag :activité, options_for_select(@responsabilites_anterieures, params[:activité]), class: 'slim-select', include_blank: true, onchange: 'this.form.submit()' %>
      </div>
    </div>

    <div class="flex flex-wrap">
      <div class="sm:w-4/12 pr-2">
        <%= label_tag :intervenant %>
        <%= select_tag :intervenant, grouped_options_for_select(Intervenant.for_select, params[:intervenant]), 
                        class: "slim-select join-item",
                        include_blank: true,
                        onchange: 'this.form.submit()' %>
      </div>
      <div class="sm:w-4/12 pr-2">
        <%= label_tag :formation %>
        <%= select_tag :formation, grouped_options_for_select(Formation.for_select, params[:formation]), class: 'slim-select',
                        include_blank: true, onchange: 'this.form.submit()' %>
      </div>

      <%= button_tag name: 'commit', value: 'RàZ', class: "btn text-slate-500 btn-sm self-end", title: "Remise à zéro des filtres" do %>
        <i class="fas fa-times"></i> 
        RàZ
      <% end %>
    </div>
  <% end %>
</div>

<div class="overflow-x-auto">
  <table class="table">
    <thead class="bg-slate-100 border">
      <tr>
        <th><%= sort_link 'responsabilites.updated_at', 'MÀJ' %></th>
        <th><%= sort_link 'responsabilites.debut', 'Date début' %></th>
        <th><%= sort_link 'intervenants.nom', 'Intervenant' %></th>
        <th><%= sort_link 'formations.abrg', 'Formation' %></th>
        <th><%= sort_link 'responsabilites.titre', 'Activité' %></th>
      </tr>
    </thead>

    <tbody>
      <%= render @responsabilites.includes(:formation, :intervenant) %>
    </tbody>

    <tfoot>
      <tr><th colspan=8></th></tr>
    </tfoot>
  </table>
</div>

<div class="page_info">
  <%= page_entries_info @responsabilites %>
</div>

<div class="planning_pagination">
  <%= will_paginate @responsabilites %>
</div>
<br>
<%= link_to url_for(params.permit(:formation, :intervenant, :start_date, :end_date, :status, :activité).merge(format: :xls)), class: 'btn btn-sm btn-success btn-outline mb-12' do %>
  <%= fa_icon 'file-excel' %>
  Exporter vers Excel
<% end %>


