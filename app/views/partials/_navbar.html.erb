<nav class="navbar sticky top-0 z-50 shadow py-0 <%= ENV["STAGING_COLOR_MODE"].present? ? ENV["STAGING_COLOR_MODE"] : 'bg-base-100' %>">
  <div class="flex-1">
    <span class="font-black mr-12">AIKKU Plann (démo)</span>
    <ul class="menu menu-horizontal px-1">
      <% if user_signed_in? %>
        <% if current_user.étudiant? %>
          <%= navbar_nav_item('ma journée', 'event', mes_sessions_etudiant_path, nil, 'mes_sessions_etudiant') %>
          <%= navbar_nav_item('cours', 'calendar_month', cours_path, 'Planning', 'index') %>
        <% elsif current_user.intervenant? || current_user.enseignant? %>
          <%= navbar_nav_item('ma journée', 'event', mes_sessions_intervenant_path, nil, 'mes_sessions_intervenant') %>
          <%= navbar_nav_item('cours', 'calendar_month', cours_path, 'Planning', 'index') %>
        <% else %>
          <%= navbar_nav_item('cours', 'calendar_month', cours_path, 'Planning') %>
        <% end %>
      <% else %>
        <%= navbar_nav_item('cours', 'calendar_month', cours_path, 'Planning') %>
      <% end %>
      <%= navbar_nav_item('salles', 'meeting_room', occupation_salles_path) %>
      <%= navbar_nav_item('formations', 'work', formations_path) %>
      <%= navbar_nav_item('intervenants', 'co_present', intervenants_path) %>
      <%= navbar_nav_item('etudiants', 'school', etudiants_path) %>
      <% if user_signed_in? && current_user.rh? %>
        <%= navbar_nav_item('dossiers', 'folder', dossiers_path) %>
        <%= navbar_nav_item('vacations', 'co_present', vacations_path) %>
      <% end %>

      <% if user_signed_in? && policy(:tool).audit_cours? %>
        <li class="nav-item">
            <% is_active = params[:action] == 'audit_cours' %>
            <%= link_to tools_audit_cours_path, class: "flex items-center gap-1 py-0 text-#{ is_active ? 'primary' : 'base-content' }" do %>
              <span class="material-symbols-outlined text-xl mb-1">
                calendar_check
              </span>
              À booker
              <% aplanifier = CoursNonPlanifie.count %>
              <% if aplanifier > 0 %>
                <span class="badge badge-error text-white"><%= aplanifier %></span>
              <% end %>
            <% end %>
          </li>
      <% end %>
      <% if user_signed_in? && (current_user.accueil? || [41,35,3132].include?(current_user.id)) %>
        <li class="nav-item">
          <% is_active = params[:action] == 'commandes_v2' %>
          <%= link_to tools_commandes_v2_path, class: "flex items-center gap-1 py-0 text-#{ is_active ? 'primary' : 'base-content' }" do %>
            <span class="material-symbols-outlined text-xl mb-1">
              local_cafe
            </span>
            Commandes v2
            <% commandes_v2 = Cour.joins(:options).where(options: {catégorie: :commande}).where.not("options.description ILIKE ?", '%Fait le%').count %>
            <% if commandes_v2 > 0 %>
              <span class="badge badge-info text-white"><%= commandes_v2 %></span>
            <% end %>
          <% end %>
        </li>
      <% end %>
    </ul>
  </div>

  <div>
    <ul class="menu menu-horizontal items-center px-1">
      <% if user_signed_in? %>
        <li class="flex flex-row items-center gap-2 mr-12">
          <%= link_to current_user do %>
            <span class="material-symbols-outlined p-0">
              account_circle
            </span>
            <div class="p-0">
              <%= current_user.username %>
              <% if current_page? root_path %>
                <br>
                Dernière connexion il y a <%= time_ago_in_words current_user.last_sign_in_at %>
              <% end %>
            </div>
          <% end %>
        </li>
        <% if policy(Note).index? %>
          <li class="indicator mr-4">
            <%= link_to notes_path, class: "flex items-center gap-1 py-0" do %>
              <span class="material-symbols-outlined text-xl mb-1">
                lightbulb_2
              </span>
              <% notes = current_user.notes.count %>
              <% if notes > 0 %>
                <span class="indicator-item badge badge-warning"><%= notes %></span> 
              <% end %>
            <% end%>
          </li>
        <% end %>
        <% if policy(current_user).right_navbar? %>
          <%= navbar_nav_item('', 'build', tools_index_path) %>
          <%= navbar_nav_item('', 'search', tools_rechercher_path) %>
        <% end %>
        <%= navbar_nav_item('', 'info', guide_index_path) %>

        <li>
          <%= link_to destroy_user_session_path, 'data-turbo-method': :delete, title: "Fermer la session de #{current_user.email}", class: 'flex items-center gap-1 py-0' do %>
            <span class="material-symbols-outlined text-xl mb-0.5">
              logout
            </span>
          <% end %> 
        </li>

      <% else %>
        <%= navbar_nav_item('guide', 'info', guide_index_path) %>
        <%= navbar_nav_item('Se connecter', 'login', new_user_session_path) %>
      <% end %>
    </ul>
  </div>
</nav>