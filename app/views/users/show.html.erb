<div class="border-b mt-6 mb-2 pb-4">

	<% if current_user.try(:admin?) %>	
		<div class="buttons-group float-right">
			<%= link_to edit_user_path(@user), class: 'btn btn-ghost' do %>
				<%= fa_icon 'edit', text: ' Modifier' %>
			<% end %>

			<%= link_to users_path, class: 'btn btn-ghost' do %>
				<%= fa_icon 'list-alt', text: ' Retour' %>
			<% end %>
		</div>

	<% end %>

	<h1 class="text-3xl flex items-center gap-3">
		<span class="material-symbols-outlined text-3xl">
			<%= @user.otp_required_for_login? ? 'person_shield' : 'person' %>
		</span>
		<%= @user.email %>
	</h1>
</div>
<br>

<p class="mb-4">
	<strong>Nom :</strong>
	<%= @user.nom %>
</p>
<p class="mb-4">
	<strong>Prénom :</strong>
	<%= @user.prénom %>
</p>
<p class="mb-4">
	<strong>Mobile :</strong>
	<%= @user.mobile %>
</p>
<p class="mb-4">
	<strong>Rôle :</strong>
	<%= @user.role.humanize %>
</p>
<p class="mb-4">
	<strong>Email :</strong>
	<%= @user.email %>
</p>
<br>

<p class="mb-4">
	Compte créé : 
	le <%= l(@user.created_at) %> 
	| Il y a <%= time_ago_in_words(@user.created_at) %>
</p>

<% if @user.discarded_at %>
	<p class="mb-4 font-bold">
		Compte désactivé : 
		le <%= l(@user.discarded_at) %> 
		| Il y a <%= time_ago_in_words(@user.discarded_at) %>
		| Vous pouvez réactiver ce compte en cliquant <%= link_to "ici", reactivate_user_path(@user), class: 'text-primary hover:underline' %>.
	</p>
<% end %>

<% unless @user.sign_in_count.zero? %>
	<p class="mb-4">
		Nbr connexions : <%= @user.sign_in_count %> 
	</p>
	<p class="mb-4">
		Connexion actuelle : 
		le <%= l(@user.current_sign_in_at) %> 
		| Il y a <%= time_ago_in_words(@user.current_sign_in_at) %>
	</p>
	<p class="mb-4">
		Dernière connexion : 
		le <%= l(@user.last_sign_in_at) %> 
		| Il y a <%= time_ago_in_words(@user.last_sign_in_at) %>
	</p>
<% end %>

<div class="mt-4 mb-12">
	<% if policy(User).enable_otp? && current_user == @user %>
		<% if !current_user.otp_required_for_login %>
			<div class="text-lg"></div>
			Activer la double authentification
			<%= link_to "par mail", mail_otp_users_path, class: "btn btn-success btn-outline hover:!text-white btn-sm", 'data-turbo': false %>
			|
			<%= link_to "avec une application d'authentification", qrcode_otp_users_path, class: "btn btn-success btn-outline hover:!text-white btn-sm", 'data-turbo': false %>
		<% else %>
			<p class="text-success">Double authentification activée</p>
			<%= button_to "Désactiver la double authentification", disable_otp_users_path, class: "btn btn-warning text-white btn-sm" %>
		<% end %>
	<% end %>
</div>
<br>

<% if current_user && !current_user.étudiant? %>
	<div class="text-lg">
		Audit des modifications
	</div>
	<div class="overflow-x-auto bg-base-100"> 
		<table class="table table-xs">
			<thead class="bg-slate-100 border">
				<th>Date</th>
				<th>Utilisateur</th>
				<th>Type</th>
				<th>Record_id</th>
				<th>Action</th>
				<th>Modifications</th>
			</thead>
			<%= render partial: 'tools/audit', collection: @audits %>
		</table>
	</div>

	<div class="page_info">
		<%= page_entries_info @audits, 'Audit' %>
	</div>

	<div class="planning_pagination">
		<%= will_paginate @audits %>
	</div>
<% end %>