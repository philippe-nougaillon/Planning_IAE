<div class="border-b mt-6 mb-2 pb-4">
    <div class="float-right">
        <%= link_to user_path(current_user), class: 'btn btn-ghost' do %>
            <%= fa_icon 'list-alt', text: ' Retour' %>
        <% end %>
    </div>
    <h1 class="text-3xl flex items-center gap-3">
        <span class="material-symbols-outlined text-3xl">
            person_shield
        </span>
        Activation de la double authentification
    </h1>
</div>

<div>
    <% totp_uri = current_user.otp_provisioning_uri(current_user.email, issuer: "IAE-Planning") %>
    <p class="mb-8">
        Veuillez scanner ce QRCode avec une <b>application mobile d'authentification</b>.
        <br>
        Si vous n'en avez pas, téléchargez sur votre téléphone
        <%= image_tag "Google_Authenticator.svg.png", width: 40, class: 'inline' %>
        <b>Google Authenticator</b>
        ou
        <%= image_tag "microsoft_authenticator_icon.png", width: 40, class: 'inline' %>
        <b>Microsoft Authenticator</b>.
    </p>

    <%= raw RQRCode::QRCode.new(totp_uri).as_svg(module_size: 4) %>
    
    <p class="mt-6">Saisir ici votre code de vérification</p>
    <%= form_with url: enable_otp_users_path, method: :post, class: "flex flex-col w-min gap-4" do |f| %>
        <%= f.text_field :otp_attempt, class: 'input input-bordered input-sm', required: true, autofocus: true %>
        <%= hidden_field_tag :method, "app" %>
        <%= f.submit "Activer la double authentification", class: "btn btn-success btn-outline hover:!text-white" %>
    <% end %>
</div>
